# 設計書

## 概要

天文部が出展する各教室の混雑状況の管理システム  
入力も来訪者が行い、来訪者向けに表示される

## 機能要件

ユーザ入力用のページと、全体の混雑状況の表示ページが必要  
どちらもユーザに見せるため、UIは作り込む必要がある

教室に設置したChromeBookから入力/閲覧を行う想定だが、  
一応スマホからのアクセスも想定したほうがいいかもしれない

## 非機能要件

- 文化祭の期間中のみ動けばいい
- スケーラビリティも不要(数端末程度)
- セキュリティも不要
- 1分間隔ポーリング程度のリアルタイム性で十分

## 仕様

### 入力ページ

混雑状況(空き具合)は◎○△くらいでいい  
もしくは数値で入力か

### 表示ページ

リストによるテキスト表示がマップによるグラフィカル表示か
マップならグラデーションで表示しても良いかも

## 設計

必要とされる可用性(整合性含め)が低いのでシンプルな構成で良い

- Cloudflare Pages
- Cloudflare Workers
- Cloudflare Workers KV

### フロントエンド

静的コンテンツを配信(Cloudflare Pages)  
配信されたJSがAPIエンドポイントを叩く(AJAX)

ページは入力用と表示用だけなので簡易的なSPAで良い

#### 入力ページ

教室の選択と混雑状況を選択し送信

教室の選択はドロップダウンリスト？  
特定の教室のみを表示するページ(設置用)も必要

#### 表示ページ

混雑状況は1ページで表示する

|     教室      | 混雑状況 |
| ------------- | -------- |
| 地学実験室    | ◎        |

のようなリスト形式か、マップによるグラフィカルな表示か

マップにする場合はいくつかの階に分かれるのが問題点  
(2Fの情報教室、3Fの地学実験室、RFのドームなど)  
でもマップにすればナビゲーション機能を統合できる(集合場所等)  
とりあえずビューを切り替えられるようにしておけばいい

### バックエンド

APIエンドポイントを提供(Cloudflare Workers)  
データはKVSに保存(Cloudflare Workers KV)

ただしWorkers KVに1000書き込み/日の制限があるため微妙なライン  
DynamoDB等も選択肢に入れておく

#### APIエンドポイント

- `/rooms`: 教室の一覧
  - GET : 教室の一覧を取得
    - レスポンス
      - ボディ
        - `rooms`: 教室データのリスト
          - `room_id`: 教室ID
          - `name`: 教室名
- `/crowd`: 混雑状況
  - GET : 全教室の混雑状況を取得
    - レスポンス
      - ボディ
        - `crowd`: 混雑状況データのリスト
          - `room_id`: 教室ID
          - `name`: 教室名
          - `status`: 混雑状況(number)
          - `updated_at`: 更新日時
- `/crowd/:room_id`: 特定教室の混雑状況
  - GET : 特定教室の混雑状況を取得
    - レスポンス
      - ボディ
        - `room_id`: 教室ID
        - `name`: 教室名
        - `status`: 混雑状況(number)
        - `updated_at`: 更新日時
  - PUT : 混雑状況を更新
    - リクエスト
      - ボディ
        - `status`: 混雑状況(number)
